
{% if app.user.guide is not empty %}
<li><a href="">tesf</a></li>
{% endif %}

<a href="https://www.google.com/maps/search/?api=1&query={{ reservation.pointDeRencontre }}" target="_blank">
    Voir sur Google Maps
</a>>



//DQL qui ne reconnais pas le datediff
public function findClosestAvailableDate(string $day): ?\DateTime
{
    $targetDate = new \DateTime($day);
    $now = new \DateTime();

    $result = $this->createQueryBuilder('r')
        ->select('r.day')
        ->where('r.day >= :now')
        ->setParameter('now', $now->format('Y-m-d'))
        ->orderBy('ABS(DATEDIFF(r.day, :targetDate))', 'ASC')
        ->setParameter('targetDate', $targetDate->format('Y-m-d'))
        ->setMaxResults(1)
        ->getQuery()
        ->getOneOrNullResult();

    return $result ? $result['day'] : null;
}


//SQL natif qui ne reconnais pas fetch
public function findClosestAvailableDate(string $day): ?\DateTime
{
    $targetDate = (new \DateTime($day))->format('Y-m-d');
    $now = (new \DateTime())->format('Y-m-d');

    $conn = $this->getEntityManager()->getConnection();

    $sql = '
        SELECT r.day
        FROM reservations r
        WHERE r.day >= :now
        ORDER BY ABS(DATEDIFF(r.day, :targetDate)) ASC
        LIMIT 1
    ';

    $stmt = $conn->prepare($sql);
    $stmt->execute([
        'now' => $now,
        'targetDate' => $targetDate,
    ]);

    $result = $stmt->fetch();

    return $result ? new \DateTime($result['day']) : null;

<!-- Temps avant reservations -->
    <li class="list-group-item">
        <i class="fas fa-hourglass-half text-warning"></i>
        <strong>Temps restant :</strong>
        {% if reservation.day|date('U') > "now"|date('U') %}
            <span class="text-success">Dans {{ (reservation.day|date('U') - "now"|date('U'))//86400 }} jours</span>
        {% else %}
            <span class="text-danger">Passée</span>
        {% endif %}
    </li>

    <div class="dropdown">
        <button class="btn btn-outline-primary btn-sm dropdown-toggle" type="button" id="actionsMenu" data-bs-toggle="dropdown" aria-expanded="false">
            Actions
        </button>
        <ul class="dropdown-menu" aria-labelledby="actionsMenu">
            <li>
                <a class="dropdown-item" href="#">Démarrer</a>
            </li>
            <li>
                <a class="dropdown-item" href="#">Annuler</a>
            </li>
            <li>
                <a class="dropdown-item text-danger" href="#">Supprimer</a>
            </li>
        </ul>
    </div>

<!-- Reservations card user -->
    <div class="col-lg-4 col-md-6">
        <div class="mt-3 card shadow-sm border">
            <div class="card-header bg-primary text-white text-center">
                <h5><i class="fas fa-ticket-alt"></i> Réservation N°{{ reservation.reservNumber }}</h5>
            </div>
            <div class="card-body">
                <ul class="list-group">
                    <li class="list-group-item d-flex align-items-center">
                        <i class="fas fa-calendar-alt text-primary me-2"></i>
                        <span><strong>Date :</strong> {{ reservation.day|date('d/m/Y') }}</span>
                    </li>
                    <li class="list-group-item d-flex align-items-center">
                        <i class="fas fa-clock text-success me-2"></i>
                        <span><strong>Début :</strong> {{ reservation.begin|date('H:i') }} - <strong>Fin :</strong> {{ reservation.end|date('H:i') }}</span>
                    </li>
                    <li class="list-group-item d-flex align-items-center">
                        <i class="fas fa-map-marker-alt text-danger me-2"></i>
                        <span><strong>Ville :</strong> {{ reservation.city.name }}</span>
                    </li>
                    <li class="list-group-item d-flex align-items-center">
                        <i class="fas fa-utensils text-warning me-2"></i>
                        <span><strong>Repas compris :</strong> {{ reservation.meal ? 'Oui' : 'Non' }}</span>
                    </li>
                    <li class="list-group-item d-flex align-items-center">
                        <i class="fas fa-users text-info me-2"></i>
                        <span><strong>Places restantes :</strong> {{ reservation.placesDispo }}</span>
                    </li>
                    <li class="list-group-item d-flex align-items-center">
                        <i class="fas fa-user-tie text-secondary me-2"></i>
                        <span><strong>Guide :</strong> {{ reservation.guide.user.pseudo }}</span>
                    </li>
                    <li class="list-group-item d-flex align-items-center">
                        <i class="fas fa-info-circle text-primary me-2"></i>
                        <span><strong>Statut :</strong> <span class="badge fs-6 bg-{{ reservation.status == 'A venir' ? 'warning' : reservation.status == 'Fini' ? 'success' : 'primary' }}">{{ reservation.status }}</span></span>
                    </li>
                    <li class="list-group-item d-flex align-items-center">
                        <i class="fas fa-coins text-warning me-2"></i>
                        <span><strong>Prix :</strong> {{ reservation.price }} Crédits</span>
                    </li>
                </ul>
            </div>
            <div class="card-footer bg-light text-center">
                {% if reservation.status == 'A venir' %}
                    <button class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#cancelModal-{{ reservation.id }}"><i class="fas fa-times-circle"></i> Annuler</button>
                {% elseif reservation.status == 'Fini' %}
                    <button type="button" class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#user-endModal-{{ reservation.id }}"><i class="fas fa-check-circle"></i> Oui</button>
                    <button type="button" class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#user-endNoModal-{{ reservation.id }}"><i class="fas fa-times-circle"></i> Non</button>
                {% elseif reservation.status == 'Confirmé' %}
                    <a href="{{ path('app_user_reviews_create', { 'reservationId': reservation.id }) }}" class="btn btn-primary btn-sm"><i class="fas fa-pen"></i> Donner votre avis</a>
                {% else %}
                    <span class="text-muted">Aucune action requise</span>
                {% endif %}
            </div>
        </div>
    </div>
